<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuickBite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/heroicons@2.1.1/24/outline/index.min.js"></script>

    <style>
        /* Simple scrollbar styling for a better mobile look */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useMemo } = React;
        const { motion, AnimatePresence } = window.framer;

        // ===================================================================================
        // MOCK DATA & CONFIG (Replace with Supabase calls)
        // ===================================================================================
        const MOCK_MENU_ITEMS = [
            { id: 1, name: "Gourmet Burger", description: "Angus beef, cheddar, lettuce, tomato, and our special sauce.", price: 12.99, image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=400&q=80" },
            { id: 2, name: "Margherita Pizza", description: "Fresh mozzarella, San Marzano tomatoes, basil, and olive oil.", price: 14.50, image: "https://images.unsplash.com/photo-1598021680133-eb3a7331d324?auto=format&fit=crop&w=400&q=80" },
            { id: 3, name: "Chicken Caesar Salad", description: "Grilled chicken, romaine lettuce, croutons, and Parmesan cheese.", price: 10.25, image: "https://images.unsplash.com/photo-1550304943-4f24f54ddde9?auto=format&fit=crop&w=400&q=80" },
            { id: 4, name: "Spaghetti Carbonara", description: "Pasta with eggs, cheese, pancetta, and black pepper.", price: 13.75, image: "https://images.unsplash.com/photo-1608796837873-455b57692608?auto=format&fit=crop&w=400&q=80" },
            { id: 5, name: "Veggie Tacos", description: "Three soft tacos with grilled vegetables, salsa, and avocado.", price: 9.99, image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?auto=format&fit=crop&w=400&q=80" },
        ];

        const MOCK_ORDERS = [
            { id: 'ORD1001', customer: 'John Doe', total: 27.49, status: 'Preparing', items: [{ ...MOCK_MENU_ITEMS[0], quantity: 1 }, { ...MOCK_MENU_ITEMS[2], quantity: 1 }] },
            { id: 'ORD1002', customer: 'Jane Smith', total: 14.50, status: 'Received', items: [{ ...MOCK_MENU_ITEMS[1], quantity: 1 }] },
        ];

        const ORDER_STATUSES = ["Received", "Preparing", "Out for Delivery", "Delivered", "Cancelled"];

        // ===================================================================================
        // HELPER COMPONENTS
        // ===================================================================================
        const Icon = ({ name, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                {name === 'cart' && <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.838-5.514a1.875 1.875 0 0 0-1.642-2.58H5.169m-1.883 5.514A2.25 2.25 0 0 1 6.331 8.25h11.338a2.25 2.25 0 0 1 2.15 3.28l-1.838 5.514a2.25 2.25 0 0 1-2.15 1.626H6.331a2.25 2.25 0 0 1-2.15-3.28l.044-.135Z" />}
                {name === 'user' && <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />}
                {name === 'admin' && <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />}
                {name === 'plus' && <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />}
                {name === 'minus' && <path strokeLinecap="round" strokeLinejoin="round" d="M5 12h14" />}
                {name === 'trash' && <path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />}
                {name === 'x' && <path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" />}
            </svg>
        );

        // ===================================================================================
        // MENU COMPONENTS
        // ===================================================================================
        const MenuItem = ({ item, onAddToCart }) => {
            return (
                <motion.div
                    className="flex bg-white p-3 rounded-lg shadow-sm"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.3 }}
                >
                    <div className="flex-1 pr-4">
                        <h3 className="font-bold text-md text-gray-800">{item.name}</h3>
                        <p className="text-gray-500 text-sm my-1">{item.description}</p>
                        <p className="font-semibold text-gray-900">${item.price.toFixed(2)}</p>
                    </div>
                    <div className="relative w-24 h-24 flex-shrink-0">
                        <img src={item.image} alt={item.name} className="w-full h-full rounded-md object-cover" />
                        <button
                            onClick={() => onAddToCart(item)}
                            className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-20 h-9 bg-white text-green-600 font-bold rounded-md shadow-md text-sm hover:bg-green-50 transition-all duration-200"
                        >
                            ADD
                        </button>
                    </div>
                </motion.div>
            );
        };

        // ===================================================================================
        // CART COMPONENTS
        // ===================================================================================
        const CartItem = ({ item, updateQuantity, removeFromCart }) => (
            <div className="flex items-center justify-between py-3">
                <div className="flex items-center">
                    <img src={item.image} alt={item.name} className="w-12 h-12 rounded-md object-cover mr-3" />
                    <div>
                        <p className="font-semibold text-sm">{item.name}</p>
                        <p className="text-gray-600 text-sm">${item.price.toFixed(2)}</p>
                    </div>
                </div>
                <div className="flex items-center">
                    <div className="flex items-center border border-gray-300 rounded-md">
                        <button onClick={() => updateQuantity(item.id, item.quantity - 1)} className="p-1"><Icon name="minus" className="w-4 h-4 text-gray-600" /></button>
                        <span className="px-3 text-sm font-bold">{item.quantity}</span>
                        <button onClick={() => updateQuantity(item.id, item.quantity + 1)} className="p-1"><Icon name="plus" className="w-4 h-4 text-gray-600" /></button>
                    </div>
                </div>
            </div>
        );

        const Cart = ({ cart, updateQuantity, placeOrder }) => {
            const subtotal = useMemo(() => cart.reduce((sum, item) => sum + item.price * item.quantity, 0), [cart]);
            const deliveryFee = 2.50;
            const total = subtotal + deliveryFee;

            if (cart.length === 0) {
                return (
                    <div className="text-center p-8">
                        <h2 className="text-xl font-bold mb-2">Your cart is empty</h2>
                        <p className="text-gray-500">Add items from the menu to get started!</p>
                    </div>
                );
            }

            return (
                <div className="p-4 h-full flex flex-col">
                    <h2 className="text-2xl font-bold mb-4">Your Order</h2>
                    <div className="flex-1 overflow-y-auto">
                        {cart.map(item => <CartItem key={item.id} item={item} updateQuantity={updateQuantity} />)}
                    </div>
                    <div className="border-t pt-4 mt-4">
                        <div className="flex justify-between text-gray-600 mb-1"><p>Subtotal</p><p>${subtotal.toFixed(2)}</p></div>
                        <div className="flex justify-between text-gray-600 mb-2"><p>Delivery Fee</p><p>${deliveryFee.toFixed(2)}</p></div>
                        <div className="flex justify-between font-bold text-lg"><p>Total</p><p>${total.toFixed(2)}</p></div>
                        <button onClick={placeOrder} className="w-full bg-green-600 text-white font-bold py-3 rounded-lg mt-4 hover:bg-green-700 transition-colors">
                            Place Order
                        </button>
                    </div>
                </div>
            );
        };

        // ===================================================================================
        // LOGIN/AUTH COMPONENT
        // ===================================================================================
        const LoginScreen = ({ setUser }) => {
            const handleLogin = (e) => {
                e.preventDefault();
                // --- TWILIO & SUPABASE INTEGRATION POINT ---
                // 1. Get phone number from form input.
                // 2. Call a Supabase Edge Function to send OTP via Twilio.
                // 3. Show OTP input field.
                // 4. Verify OTP with another Supabase function.
                // 5. On success, call `setUser` with user data from Supabase.
                console.log("Simulating OTP login...");
                alert("Login Successful! (Mocked)");
                setUser({ name: "Demo User", phone: "+911234567890" });
            };

            return (
                <div className="p-6">
                    <h2 className="text-2xl font-bold mb-4">Login</h2>
                    <p className="text-gray-600 mb-6">Enter your phone number to continue.</p>
                    <form onSubmit={handleLogin}>
                        <input
                            type="tel"
                            placeholder="Phone Number"
                            className="w-full p-3 border border-gray-300 rounded-lg mb-4"
                        />
                        <button type="submit" className="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">
                            Send OTP
                        </button>
                    </form>
                </div>
            );
        };

        // ===================================================================================
        // ADMIN DASHBOARD COMPONENTS
        // ===================================================================================
        const AdminDashboard = ({ orders, setOrders }) => {
            const updateStatus = (orderId, newStatus) => {
                // --- SUPABASE INTEGRATION POINT ---
                // This is where you would call:
                // await supabase.from('orders').update({ status: newStatus }).eq('id', orderId);
                const updatedOrders = orders.map(o => o.id === orderId ? { ...o, status: newStatus } : o);
                setOrders(updatedOrders);
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'Received': return 'bg-blue-100 text-blue-800';
                    case 'Preparing': return 'bg-yellow-100 text-yellow-800';
                    case 'Out for Delivery': return 'bg-indigo-100 text-indigo-800';
                    case 'Delivered': return 'bg-green-100 text-green-800';
                    case 'Cancelled': return 'bg-red-100 text-red-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            return (
                <div className="p-4">
                    <h2 className="text-2xl font-bold mb-4">Admin Dashboard</h2>
                    <div className="space-y-4">
                        {orders.map(order => (
                            <div key={order.id} className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="flex justify-between items-center mb-2">
                                    <p className="font-bold">{order.id}</p>
                                    <p className="font-semibold">${order.total.toFixed(2)}</p>
                                </div>
                                <p className="text-sm text-gray-600 mb-3">{order.customer}</p>
                                <div className="mb-3">
                                    {order.items.map(item => (
                                        <p key={item.id} className="text-sm text-gray-500">{item.quantity} x {item.name}</p>
                                    ))}
                                </div>
                                <div className="flex items-center justify-between">
                                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(order.status)}`}>
                                        {order.status}
                                    </span>
                                    <select
                                        value={order.status}
                                        onChange={(e) => updateStatus(order.id, e.target.value)}
                                        className="border border-gray-300 rounded text-sm p-1"
                                    >
                                        {ORDER_STATUSES.map(status => <option key={status} value={status}>{status}</option>)}
                                    </select>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ===================================================================================
        // PAYMENT STATUS MODAL
        // ===================================================================================
        const PaymentStatusModal = ({ status, onClose }) => (
            <AnimatePresence>
                {status && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
                        onClick={onClose}
                    >
                        <motion.div
                            initial={{ scale: 0.7, opacity: 0 }}
                            animate={{ scale: 1, opacity: 1 }}
                            exit={{ scale: 0.7, opacity: 0 }}
                            className="bg-white rounded-lg p-8 text-center max-w-sm w-full"
                            onClick={e => e.stopPropagation()}
                        >
                            {status === 'success' ? (
                                <>
                                    <div className="w-16 h-16 bg-green-100 rounded-full mx-auto flex items-center justify-center mb-4">
                                        <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>
                                    </div>
                                    <h3 className="text-xl font-bold mb-2">Payment Successful!</h3>
                                    <p className="text-gray-600">Your order has been placed. You can track it in the admin panel.</p>
                                </>
                            ) : (
                                <>
                                    <div className="w-16 h-16 bg-red-100 rounded-full mx-auto flex items-center justify-center mb-4">
                                        <Icon name="x" className="w-8 h-8 text-red-600" />
                                    </div>
                                    <h3 className="text-xl font-bold mb-2">Payment Failed</h3>
                                    <p className="text-gray-600">Something went wrong with your payment. Please try again.</p>
                                </>
                            )}
                            <button onClick={onClose} className="mt-6 w-full bg-gray-800 text-white font-bold py-2 rounded-lg">
                                Close
                            </button>
                        </motion.div>
                    </motion.div>
                )}
            </AnimatePresence>
        );

        // ===================================================================================
        // MAIN APP COMPONENT
        // ===================================================================================
        function App() {
            // State management
            const [view, setView] = useState('menu'); // 'menu', 'cart', 'login', 'admin'
            const [cart, setCart] = useState([]);
            const [user, setUser] = useState(null); // null if logged out
            const [orders, setOrders] = useState(MOCK_ORDERS);
            const [paymentStatus, setPaymentStatus] = useState(null); // null, 'success', or 'fail'

            // --- Cart Logic ---
            const addToCart = (item) => {
                setCart(prevCart => {
                    const existingItem = prevCart.find(cartItem => cartItem.id === item.id);
                    if (existingItem) {
                        return prevCart.map(cartItem =>
                            cartItem.id === item.id ? { ...cartItem, quantity: cartItem.quantity + 1 } : cartItem
                        );
                    }
                    return [...prevCart, { ...item, quantity: 1 }];
                });
            };

            const updateQuantity = (itemId, quantity) => {
                if (quantity === 0) {
                    setCart(prevCart => prevCart.filter(item => item.id !== itemId));
                } else {
                    setCart(prevCart => prevCart.map(item =>
                        item.id === itemId ? { ...item, quantity } : item
                    ));
                }
            };

            // --- Payment Logic ---
            const handlePlaceOrder = () => {
                // --- CASHFREE INTEGRATION POINT ---
                // 1. Check if user is logged in. If not, setView('login').
                if (!user) {
                    alert("Please log in to place an order.");
                    setView('login');
                    return;
                }

                console.log("Initiating payment process...");
                // 2. Call your backend (Supabase Edge Function) to create an order on Cashfree.
                //    - Pass the cart details and total amount.
                //    - Your backend returns a `payment_session_id`.

                // 3. Use Cashfree's JS SDK on the frontend.
                //    const cashfree = new Cashfree(payment_session_id);
                //    cashfree.redirect();

                // 4. For now, we'll simulate the payment outcome.
                setTimeout(() => {
                    const isSuccess = Math.random() > 0.3; // 70% chance of success
                    if (isSuccess) {
                        console.log("Payment Successful (Mocked)");
                        // 5. On successful payment, add the order to your Supabase 'orders' table.
                        const newOrder = {
                            id: `ORD${Math.floor(Math.random() * 900) + 1000}`,
                            customer: user.name,
                            total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0) + 2.50,
                            status: 'Received',
                            items: cart
                        };
                        setOrders(prev => [newOrder, ...prev]);
                        setCart([]); // Clear cart
                        setPaymentStatus('success');
                    } else {
                        console.log("Payment Failed (Mocked)");
                        setPaymentStatus('fail');
                    }
                }, 1500);
            };

            const totalCartItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            const renderView = () => {
                switch (view) {
                    case 'cart':
                        return <Cart cart={cart} updateQuantity={updateQuantity} placeOrder={handlePlaceOrder} />;
                    case 'login':
                        return <LoginScreen setUser={(userData) => { setUser(userData); setView('menu'); }} />;
                    case 'admin':
                        return <AdminDashboard orders={orders} setOrders={setOrders} />;
                    case 'menu':
                    default:
                        return (
                            <div className="p-4 space-y-4">
                                <h1 className="text-3xl font-bold">Good morning!</h1>
                                <div className="space-y-4">
                                    {MOCK_MENU_ITEMS.map(item => <MenuItem key={item.id} item={item} onAddToCart={addToCart} />)}
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="max-w-md mx-auto bg-gray-100 min-h-screen font-sans flex flex-col">
                    {/* Header */}
                    <header className="p-4 sticky top-0 bg-white/80 backdrop-blur-sm z-10 shadow-sm">
                        <div className="flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-800">QuickBite</h1>
                            <div className="flex items-center space-x-4">
                                {user ? <span className="text-sm">Hi, {user.name.split(' ')[0]}</span> : <button onClick={() => setView('login')} className="text-sm font-medium">Login</button>}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 pb-24">
                        {renderView()}
                    </main>

                    {/* Payment Status Modal */}
                    <PaymentStatusModal status={paymentStatus} onClose={() => { setPaymentStatus(null); if (paymentStatus === 'success') setView('menu'); }} />

                    {/* Bottom Navigation */}
                    <footer className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200">
                        <nav className="flex justify-around items-center h-16">
                            <button onClick={() => setView('menu')} className={`flex flex-col items-center justify-center w-full ${view === 'menu' ? 'text-green-600' : 'text-gray-500'}`}>
                                <Icon name="user" className="w-6 h-6" />
                                <span className="text-xs font-medium">Menu</span>
                            </button>
                            <button onClick={() => setView('cart')} className={`relative flex flex-col items-center justify-center w-full ${view === 'cart' ? 'text-green-600' : 'text-gray-500'}`}>
                                <Icon name="cart" className="w-6 h-6" />
                                {totalCartItems > 0 && (
                                    <span className="absolute top-0 right-1/2 -mr-5 w-5 h-5 bg-green-600 text-white text-xs font-bold rounded-full flex items-center justify-center">
                                        {totalCartItems}
                                    </span>
                                )}
                                <span className="text-xs font-medium">Cart</span>
                            </button>
                            <button onClick={() => setView('admin')} className={`flex flex-col items-center justify-center w-full ${view === 'admin' ? 'text-green-600' : 'text-gray-500'}`}>
                                <Icon name="admin" className="w-6 h-6" />
                                <span className="text-xs font-medium">Admin</span>
                            </button>
                        </nav>
                    </footer>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>

</html>